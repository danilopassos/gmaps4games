function C(){var aJ;this.bh;this.bp;this.bJ=0;this.bb;this.bN;var aK=null;var cO=null;this.map;this.bL;this.mapId;this.category;this.al;this.ah;this.bc;this.ak;this.bU;this.bd;this.bg;this.ds={};this.ds.x=0;this.ds.y=0;this.currentCenter;this.cJ=undefined;this.bD=0;this.bZ=1;this.dk=2;this.bS=3;this.aV=this.bD;this.overlay;this.overlayView;this.copyrights={};};C.prototype.bM=function(){return this.aK;};C.prototype.cc=function(){return this.cO;};C.prototype.bv=function(bm){user={};user.id=bm.user_id;user.name=bm.username;user.bo=bm.is_registered;user.aT=false;user.bA=false;user.ar=false;aJ.bz();};C.prototype.bq=function(){return user.bo;};C.prototype.aO=function(){return user;};C.prototype.aS=function(bx,ag){if(bx=="showOnlyMyMarkers"){user.aT=ag;}else if(bx=="showMyApproved"){user.bA=ag;}else if(bx=="showMyNonApproved"){user.ar=ag;}aJ.aZ();};C.prototype.k=function(){map.setZoom(map.getZoom()+1);};C.prototype.H=function(){map.setZoom(map.getZoom()-1);};C.prototype.K=function(){map.setCenter(bg);this.k();};C.prototype.J=function(){map.setCenter(bg);this.H();};C.prototype.cN=function(cr){if(!(typeof(bU)=="undefined"||bU==null)&& !(typeof(cr)=="undefined"||cr==null)){this.bI();this.am();this.bK();bU.showAt(cr);}};C.prototype.an=function(){if(!(typeof(bU)=="undefined"||bU==null)){bU.hide();}if(!(typeof(bd)=="undefined"||bd==null)){bd.hide();}};C.prototype.setContextMenu=function(aj,ac){bU=aj;bd=ac;};C.prototype.ad=function(cr){if(!(typeof(bU)=="undefined"||bU==null)&& !(typeof(cr)=="undefined"||cr==null)){this.an();this.bI();this.am();this.bK();bd.showAt(cr);}};C.prototype.constructor=function(){ah=[];bL=[];mapId=[];category=[];al=[];bc=[];user={};user.bo=false;aJ=this;overlay=[];};C.prototype.bj=function(du){for(i=0;i<overlay.length;i++){if(overlay[i].id==du.map_id){var j=0;if(overlay[i].layers==null){overlay[i].layers=new Array();}else{j=overlay[i].layers.length;}var l=overlay[i].layers;l[j]=new Object();l[j].id=du.map_layer_id;l[j].mapId=du.map_id;l[j].dF=du.tile_url;l[j].cl=du.tile_ext;l[j].title=du.title;l[j].img404=du.img404;l[j].dn=du.control_visible;l[j].aq=du.control_checked;l[j].type=du.type;break;}}};C.prototype.aH=function(cX){var c=0;if(cX.map_overlay_id>0){var i=overlay.length;overlay[i]=new Object();overlay[i].id=cX.map_id;overlay[i].mapId=cX.map_overlay_id;overlay[i].name=cX.name;overlay[i].dF=cX.tile_url;overlay[i].cl=cX.tile_ext;overlay[i].title=cX.map_overlay_name;overlay[i].img404=cX.img404;}this.copyrights[cX.map_id]=cX.map_copyright+", "+cX.map_mapper;if(cX.map_overlay_id==cX.map_id||cX.map_overlay_id<=0){if(cX.google_default==true){if(cX.map_type_name=='ROADMAP'){mapId[mapId.length]=google.maps.MapTypeId.ROADMAP;}else if(cX.map_type_name=='SATELLITE'){mapId[mapId.length]=google.maps.MapTypeId.SATELLITE;}ah[ah.length]=new Object();ah[ah.length-1].mapId=cX.map_id+"";ah[ah.length-1].bL=mapId[mapId.length-1];}else{bL[bL.length]=new google.maps.ImageMapType({projection:new t(),getTileUrl:function(aU,zoom){if(cX.empty_map){return "tiles/blank.png";}var ck=Math.pow(2,zoom)-1;if(aU.x<0||aU.y<0||aU.x>ck||aU.y>ck){return "tiles/blank.png";}return "tiles/getTile.php?i="+cX.tile_url+zoom+"_"+aU.x+"_"+aU.y+"."+cX.tile_ext+"&m="+cX.img404;},tileSize:new google.maps.Size(256,256),isPng:(cX.tile_ext=="png")?true:false,name:cX.name,alt:cX.name,opacity:(cX.map_overlay_name=="BASE_OPACITY"?0.35:1)});bL[bL.length-1].projection=new t();mapId[mapId.length]=cX.map_id+"";bL[bL.length-1].maxZoom=cX.max_zoom;bL[bL.length-1].zoom=cX.default_zoom;}this.aK=cX.marker_url;this.cO=cX.marker_ext;}};C.prototype.aC=function(dM){this.aC(dM,false)};C.prototype.aC=function(cV,cB){var aU=map.getProjection().fromLatLngToPoint(cV);var tileSize=256;if(aU.x<0||aU.y<(cB?tileSize/2:tileSize)-tileSize||aU.x>tileSize||aU.y>tileSize){return false;}else{return true;}};C.prototype.aw=function(){var aE={streetViewControl:false,zoom:(bL[0]==null?0:bL[0].zoom),center:new google.maps.LatLng(0,0),backgroundColor:'#deecfd',enableEventPropagation:true,mapTypeControlOptions:{mapTypeIds:mapId,style:(mapId.length>8?google.maps.MapTypeControlStyle.DROPDOWN_MENU:google.maps.MapTypeControlStyle.DEFAULT)}};map=new google.maps.Map(document.getElementById("map_canvas"),aE);for(var i=0;i<mapId.length;i++){map.mapTypes.set(mapId[i],bL[i]);bc[mapId[i]]=new Object();bc[mapId[i]].pos=new google.maps.LatLng(0,0);bc[mapId[i]].zoom=(bL[i]==null?0:bL[i].zoom);}map.setMapTypeId(mapId[0]);var aJ=this;currentCenter=map.getCenter();google.maps.event.addListener(map,'click',function(event){if(aJ.aV==aJ.bS){aJ.ae(event.latLng);}});google.maps.event.addListener(map,'rightclick',function(event){bg=event.latLng;bg.mapId=aJ.bC(map.getMapTypeId());bg.dz=aJ.bJ;if(aJ.aC(event.latLng)){aJ.cN([event.pixel.x+aJ.ds.x,event.pixel.y+aJ.ds.y]);}else{aJ.an();}});google.maps.event.addListener(map,'center_changed',function(){if(!(aJ.aC(map.getCenter(),true))){map.setCenter(currentCenter);return;}else{currentCenter=map.getCenter();}bc[map.getMapTypeId()].pos=currentCenter;bc[map.getMapTypeId()].zoom=map.getZoom();});google.maps.event.addListener(map,'maptypeid_changed',function(event){if(bE(map.getMapTypeId())){aJ.F(map.getMapTypeId());map.setZoom(bc[map.getMapTypeId()].zoom);map.setCenter(bc[map.getMapTypeId()].pos);aJ.V(map.getMapTypeId());}});google.maps.event.addListener(map,'zoom_changed',function(event){aJ.an();bc[map.getMapTypeId()].pos=map.getCenter();bc[map.getMapTypeId()].zoom=map.getZoom();});aJ.aV=aJ.bD;var marker=new google.maps.Marker({position:new google.maps.LatLng(new google.maps.LatLng(5000,5000)),title:"fake",autoPan:true,clickable:true,draggable:false,map:map,});marker.bu=false;marker.id= -1;al.push(marker);var div=document.createElement('DIV');div.innerHTML="";aJ.cJ=new google.maps.InfoWindow({content:div});aJ.cJ.open(map,marker);aJ.aW(map.getMapTypeId());aX=document.createElement("div");aX.id="map-copyright";aX.style.fontSize="11px";aX.style.fontFamily="Arial, sans-serif";aX.style.margin="0 2px 2px 0";aX.style.whiteSpace="nowrap";map.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push(aX);betaDiv=document.createElement("div");betaDiv.style.backgroundImage="url('beta_maps.png')";betaDiv.style.width="193px";betaDiv.style.height="62px";betaDiv.style.marginTop="12px";betaDiv.id="map-beta";map.controls[google.maps.ControlPosition.TOP_LEFT].push(betaDiv);google.maps.event.addListenerOnce(map,'idle',function(){aJ.V(map.getMapTypeId());});overlayView=new google.maps.OverlayView();overlayView.draw=function(){};overlayView.setMap(map);};C.prototype.V=function(mapId){try{aX=document.getElementById("map-copyright");if(mapId in this.copyrights){aX.innerHTML=this.copyrights[mapId];}else{aX.innerHTML="";}}catch(err){}};C.prototype.bC=function(mapId){if(!bE(mapId)){for(var i=0;i<ah.length;i++){if(mapId==ah[i].bL){return ah[i].mapId;}}}return mapId;};C.prototype.v=function(dh){aJ.v(dh,false);};C.prototype.v=function(dh,ignoreCheck){if(!ignoreCheck&&aJ.bJ==dh.id){return;}map.overlayMapTypes.clear();var c=0;if(dh.layers!=null){for(i=0;i<dh.layers.length;i++){if(dh.layers[i].type=="B"&&dh.layers[i].aq){var o=dh.layers[i];map.overlayMapTypes.insertAt(c++,new L(o.id,o.name,o.name,o.dF,o.cl,o.img404));}}}map.overlayMapTypes.insertAt(c++,new L(dh.id,dh.name,dh.name,dh.dF,dh.cl,dh.img404));if(dh.layers!=null){for(i=0;i<dh.layers.length;i++){if(dh.layers[i].type=="F"&&dh.layers[i].aq){var o=dh.layers[i];map.overlayMapTypes.insertAt(c,new L(o.id,o.name,o.name,o.dF,o.cl,o.img404));c++;}}}var el=map.controls[google.maps.ControlPosition.RIGHT_TOP].getAt(0).childNodes;for(var i=0;i<el.length;i++){if(dh.id==el[i].ocid){el[i].style.fontWeight="Bold";}else{el[i].style.fontWeight="";}}if(map.controls[google.maps.ControlPosition.RIGHT_TOP].length>1){map.controls[google.maps.ControlPosition.RIGHT_TOP].removeAt(1);}if(dh.layers!=null){var bF=document.createElement('DIV');bF.style.padding='5px';for(var i=0;i<dh.layers.length;i++){if(dh.layers[i].dn){bF.appendChild(aJ.ay(dh.layers[i].id,dh.layers[i].title,dh.layers[i],i));}}if(bF.childNodes.length>0){bF.index=2;map.controls[google.maps.ControlPosition.RIGHT_TOP].push(bF);}}aJ.bJ=dh.id;aJ.aZ();aJ.am();aJ.V(dh.id);};C.prototype.ay=function(id,title,dh,position){position=(position==0?0:position+1);var control=document.createElement('DIV');control.className="overlayControl";control.innerHTML=title;control.ocid=id;google.maps.event.addDomListener(control,'click',function(){if(control.style.fontWeight=="bold"){map.overlayMapTypes.forEach(function(item,index){if(item!=null&&id==item.id){map.overlayMapTypes.removeAt(index);control.style.fontWeight="";}});}else{control.style.fontWeight="bold";if(dh.type=='B'){map.overlayMapTypes.insertAt(0,new L(dh.id,dh.name,dh.name,dh.dF,dh.cl,dh.img404));}else{map.overlayMapTypes.push(new L(dh.id,dh.name,dh.name,dh.dF,dh.cl,dh.img404));}};});if(dh.aq){control.style.fontWeight="bold";}return control;};C.prototype.ba=function(id,title,dh){var control=document.createElement('DIV');control.className="overlayControl";control.innerHTML=title;control.ocid=id;if(dh!=null){google.maps.event.addDomListener(control,'click',function(){aJ.v(dh);});}else{google.maps.event.addDomListener(control,'click',function(){if(aJ.bJ==0){return;}map.overlayMapTypes.clear();var el=map.controls[google.maps.ControlPosition.RIGHT_TOP].getAt(0).childNodes;for(var i=0;i<el.length;i++){el[i].style.fontWeight="";}control.style.fontWeight="bold";aJ.bJ=0;aJ.aZ();aJ.am();aJ.V(map.getMapTypeId());});control.style.fontWeight="bold";}return control;};C.prototype.ba=function(id,title,dh){var control=document.createElement('DIV');control.className="overlayControl";control.innerHTML=title;control.ocid=id;if(dh!=null){google.maps.event.addDomListener(control,'click',function(){aJ.v(dh);});}else{google.maps.event.addDomListener(control,'click',function(){if(aJ.bJ==0){return;}map.overlayMapTypes.clear();var el=map.controls[google.maps.ControlPosition.RIGHT_TOP].getAt(0).childNodes;for(var i=0;i<el.length;i++){el[i].style.fontWeight="";}control.style.fontWeight="bold";aJ.bJ=0;aJ.aZ();aJ.am();aJ.V(map.getMapTypeId());});control.style.fontWeight="bold";}return control;};C.prototype.aW=function(mapId){map.overlayMapTypes.clear();map.controls[google.maps.ControlPosition.RIGHT_TOP].clear();var ao=this.bC(mapId);var ax=document.createElement('DIV');ax.style.padding='5px';var x;var c=0;for(var i=0;i<overlay.length;i++){if(overlay[i].title.substring(0,4)=="BASE"&&overlay[i].mapId==mapId){x=overlay[i];continue;}if(ao==overlay[i].mapId){if(c==0||overlay[i].title=="1F"){c=overlay[i];}if(overlay[i].mapId==overlay[i].id){ax.appendChild(aJ.ba(overlay[i].id,overlay[i].title,null));}else{ax.appendChild(aJ.ba(overlay[i].id,overlay[i].title,overlay[i]));}}}if(ax.childNodes.length>0){ax.index=1;map.controls[google.maps.ControlPosition.RIGHT_TOP].push(ax);}if(x!=null&&x.title.substring(0,4)=="BASE"){aJ.v(c);}else{this.bJ=0;}};C.prototype.bf=function(){return aJ.bJ;};C.prototype.F=function(mapId){this.aW(mapId);this.an();this.am();this.aZ();};C.prototype.au=function(aI){var i=aI.marker_category_id;category[i]=new Object();category[i].id=aI.marker_category_id;category[i].cU=aI.marker_category_parent_id;category[i].checked=aI.checked;category[i].name=aI.name;category[i].img=aI.img;};C.prototype.bB=function(id,checked){if(category[id].checked!=checked){category[id].checked=checked;this.aZ();}};C.prototype.aM=function(cs){return category[cs];};C.prototype.cp=function(dH){if(aJ.aV==aJ.bS){bN=dH;aJ.bV();}else{aJ.aD(dH);}};C.prototype.cu=function(mkr_id){try{aJ.cp(aJ.av(mkr_id));}catch(err){}};C.prototype.bY=function(dH){var marker=this.av(dH.marker_id);var insert=false;if(marker==null){if(dH.marker_category_type_id==3){var image=new google.maps.MarkerImage(this.aK+"_"+category[dH.marker_category_id].img,new google.maps.Size(121,49),new google.maps.Point(0,0),new google.maps.Point(60,39));var shape={aU:[1,1,120,48],type:'rect'};marker=new google.maps.Marker({position:new google.maps.LatLng(dH.x,dH.y),icon:image,shape:shape,title:dH.name,autoPan:true,clickable:true,draggable:(user.id==dH.user_id),map:map});var label=new Label({map:map});label.set('zIndex',1234);label.bindTo('position',marker,'position');label.set('text',marker.getTitle());marker.label=label;}else{var aA=new google.maps.MarkerImage(this.aK+category[dH.marker_category_id].img,new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,16));marker=new google.maps.Marker({position:new google.maps.LatLng(dH.x,dH.y),icon:aA,title:dH.name,autoPan:true,clickable:true,draggable:(user.id==dH.user_id),map:map});}insert=true;}else{marker.setPosition(new google.maps.LatLng(dH.x,dH.y));marker.setTitle(dH.name);if(marker.categoryTypeId==3&&marker.label!=null){marker.label.set('text',marker.getTitle());}}marker.id=dH.marker_id;marker.bn=dH.marker_category_id;for(var i=0;i<ah.length;i++){if(ah[i].mapId==dH.map_id){marker.mapId=ah[i].bL;marker.cb=dH.map_id;break;}}if(marker.mapId==undefined){marker.mapId=dH.map_id;}marker.categoryTypeId=dH.marker_category_type_id;marker.jump_marker_id=dH.jump_marker_id;marker.az=dH.user_id;if(dH.tab_title.length>0)marker.tabTitle=dH.tab_title.split('<|>');if(dH.tab_text.length>0)marker.cL=dH.tab_text.split('<|>');marker.dg=dH.tab_id.split('<|>');marker.bP=dH.tab_user_id.split('<|>');marker.dj=dH.tab_user_name.split('<|>');marker.cC=dH.user_name;marker.name=dH.name;marker.bu=dH.visible;marker.setVisible(marker.bu==1?true:false);marker.dh=dH.overlay_id;marker.global=dH.global;if(marker.bu==1){this.ai(marker);this.aY(marker,user.id==marker.az);}else{if(marker.categoryTypeId==3&&marker.label!=null){marker.label.remove();marker.label=null;}}google.maps.event.addListener(marker,'rightclick',function(){if(user.id==marker.az&&(marker.categoryTypeId==1||marker.categoryTypeId==3)){bd=new Ext.menu.Menu({items:[{text:localize("%edit"),handler:function(){aJ.aa(marker)}},{text:localize("%delete"),handler:function(){aJ.aG(marker)}}]});bd.on("contextmenu",function(){},this,{single:true,delay:100,stopEvent:true,forumId:4});var point=overlayView.getProjection().fromLatLngToContainerPixel(marker.getPosition());aJ.ad([point.x+16,point.y+16]);}});switch(marker.categoryTypeId){case 1:case 3:if(dH.tab_title.length>0&&dH.tab_text.length>0){google.maps.event.addListener(marker,'click',function(){aJ.cp(marker);});}break;case 2:google.maps.event.addListener(marker,'click',function(){if(aJ.aV==aJ.bS){bN=marker;aJ.bV();}else{var ap=aJ.av(marker.jump_marker_id);if(ap==undefined||ap==null){return;}if(map.getMapTypeId()!=ap.mapId&&bE(map.getMapTypeId())){map.setMapTypeId(ap.mapId+"");}aJ.F(ap.mapId);for(var i=0;i<overlay.length;i++){if(overlay[i].id==ap.dh){aJ.v(overlay[i],true);}}aJ.bI();aJ.am();ap.setVisible(true);map.panTo(ap.position);aJ.aD(ap);}});break;}if(insert){al.push(marker);}};C.prototype.aZ=function(){for(var i=0;i<al.length;i++){this.ai(al[i]);}};C.prototype.ai=function(marker){if(user.aT&&marker.az!=user.id){marker.setVisible(false);if(aJ.bh!=undefined&&aJ.bh.id==marker.id){aJ.bI();}}else{if((marker.bu==1&& !user.aT)||(user.aT&&user.ar&&marker.bu==0)||(user.aT&&user.bA&&marker.bu==1)||(marker.bu==1&& !bE(marker.mapId)&& !bE(map.getMapTypeId()))){if((marker.mapId==map.getMapTypeId()&&(marker.dh==aJ.bJ||marker.global==1)&&category[marker.bn].checked==true)||((!bE(marker.mapId)&& !bE(map.getMapTypeId()))&&category[marker.bn].checked==true)){if(marker.getVisible()!=true){marker.setVisible(true);if(marker.categoryTypeId==3){var label=new Label({map:map});label.set('zIndex',1234);label.bindTo('position',marker,'position');label.set('text',marker.getTitle());marker.label=label;}}}else{if(marker.getVisible()!=false){marker.setVisible(false);if(marker.categoryTypeId==3){if(marker.label!=null){marker.label.remove();}marker.label=null;}if(aJ.bh!=undefined&&aJ.bh.id==marker.id){aJ.bI();}}}}else{marker.setVisible(false);}}};C.prototype.aa=function(marker){aJ.bI();aJ.am();var div=document.createElement('DIV');div.innerHTML="";aJ.cJ=new google.maps.InfoWindow({content:div});aJ.cJ.open(map,marker);aJ.bh=marker;var dK=new Array();dK[0]=[{title:localize("%information"),anchor:'95%',xtype:'displayfield',name:'displayFieldMarkerCategory',value:localize("%addMarkerHelper")}];var tab_title=marker.tabTitle;var tab_text=marker.cL;var tab_id=marker.dg;dN=1;if(tab_title!=undefined){for(dN=1;dN<=tab_title.length;dN++){if(user.id==marker.bP[dN-1]){dK[dN]=[{title:tab_title[dN-1],closable:true,defaultType:'textfield',items:[{readOnly:true,hidden:true,name:'tab'+dN+'_id',value:tab_id[dN-1],allowBlank:false},{fieldLabel:localize("%tabTitle"),name:'tab'+dN+'_title',value:tab_title[dN-1],allowBlank:false},{name:'tab'+dN+'_original_text',allowBlank:false,readOnly:true,hidden:true,value:tab_text[dN-1],allowBlank:false,xtype:'textarea'},{xtype:'ckeditor',fieldLabel:localize("%tabDescription"),name:'tab'+dN+'_text',value:tab_text[dN-1],width:550,height:220,CKConfig:{toolbar:'Full',customConfig:'ckeditor_cfg.js',}}]}];}else{dK[dN]=[{title:tab_title[dN-1],closable:false,readOnly:true,defaultType:'textfield',items:[{readOnly:true,hidden:true,name:'tab'+dN+'_id',value:tab_id[dN-1],allowBlank:false},{readOnly:true,fieldLabel:localize("%tabTitle"),name:'tab'+dN+'_title',value:tab_title[dN-1],allowBlank:false},{readOnly:true,xtype:'textareafield',fieldLabel:localize("%tabDescription"),name:'tab'+dN+'_text',value:tab_text[dN-1],width:550,height:220,}]}];}}}var form=Ext.create('Ext.form.Panel',{labelWidth:65,frame:false,header:false,bodyStyle:'padding:5px 0px 0',bodyBorder:false,border:false,border:false,width:650,height:370,fieldDefaults:{labelWidth:65,msgTarget:'side'},defaults:{anchor:'100%'},items:[{layout:'column',border:false,items:[{columnWidth:.4,border:false,layout:'anchor',defaultType:'textfield',items:[{fieldLabel:localize("%title"),name:'marker_title',value:marker.name,anchor:'95%',allowBlank:false}]},{columnWidth:.2,border:false,layout:'anchor',items:[{xtype:'checkboxfield',name:'global_marker',checked:(marker.global),labelWidth:100,anchor:'95%',fieldLabel:localize("%globalMarker"),}]},{columnWidth:.4,border:false,layout:'anchor',defaultType:'textfield',items:[{anchor:'95%',xtype:'displayfield',name:'displayFieldMarkerCategory',fieldLabel:localize("%category"),value:'<img class="x-tree-icon x-tree-icon-leaf icnMrkr icnMrkr'+marker.bn+'" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="> '+category[marker.bn].name}]}]},{xtype:'tabpanel',enableTabScroll:true,activeTab:0,defaults:{autoHeight:false,bodyStyle:'padding:10px'},height:300,plugins:[Ext.ux.AddTabButton],createTab:function(){dN++;return{title:localize("%tab")+" "+dN,closable:true,defaultType:'textfield',items:[{fieldLabel:localize("%tabTitle"),name:'tab'+dN+'_title',allowBlank:false},{xtype:'ckeditor',fieldLabel:localize("%tabDescription"),name:'tab'+dN+'_text',width:550,height:220,CKConfig:{toolbar:'Full',customConfig:'ckeditor_cfg.js',}}]};},items:dK}],buttons:[{id:'btnFormSave',xtype:'button',text:localize("%submit"),handler:function(){form.getForm().submit({params:{id:aJ.bh.id,category_id:aJ.bh.bn,map_id:(bE(aJ.bh.mapId))?aJ.bh.mapId:aJ.bh.cb,x:aJ.bh.getPosition().lat(),y:aJ.bh.getPosition().lng(),max_tab:dN-1,user_id:user.id,action:'edit',overlay_id:aJ.bJ},url:'ajax/marker_add.php',success:function(form,action){Ext.MessageBox.show({title:localize("%success"),msg:localize("%addMarkerSuccessText"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});aJ.am();aJ.bI();dN=0;aJ.aV=aJ.bD;},failure:function(form,action){switch(action.failureType){case Ext.form.Action.CLIENT_INVALID:Ext.MessageBox.show({title:localize("%err"),msg:localize("%errMissing"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});break;case Ext.form.Action.CONNECT_FAILURE:Ext.MessageBox.show({title:localize("%err"),msg:localize("%errConnection"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});break;case Ext.form.Action.SERVER_INVALID:Ext.MessageBox.show({title:localize("%err"),msg:action.result.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});aJ.am();aJ.bI();dN=0;aJ.bh=undefined;aJ.aV=aJ.bD;}}});}},{text:localize("%cancel"),handler:function(){aJ.am();aJ.bI();dN=0;aJ.bh=undefined;aJ.aV=aJ.bD;}}]});try{form.render(aJ.cJ.getContent());dN--;}catch(err){aJ.cJ.close();aJ.bh=undefined;aJ.aV=aJ.bD;alert(err);}google.maps.event.addListener(aJ.cJ,'closeclick',function(){aJ.bh=undefined;aJ.aV=aJ.bD;});aJ.aV=aJ.bZ;return false;};C.prototype.aG=function(marker){var as=function(be,text,cv){if(be=='ok'&&Ext.isEmpty(text)){var newMsg=localize("%deletMarkerText")+"<br /><br /><span style=\"color:red\">"+localize("%deletMarkerText2")+"</span><br /><br />";Ext.Msg.show(Ext.apply({},{msg:newMsg},cv));return;}if(be=='ok'){var bw=new Ext.data.Connection();bw.request({url:'ajax/marker_delete.php',method:'POST',params:{"marker_id":marker.id,"user_id":user.id,"reason":text},success:function(responseObject){Ext.MessageBox.show({title:localize("%success"),msg:localize("%addMarkerSuccessText"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});aJ.bI();if(marker.categoryTypeId==3){marker.label.remove();marker.label=null;}marker.setVisible(false);marker.bu=0;},failure:function(){Ext.MessageBox.show({title:localize("%err"),msg:localize("%errConnection"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});}});}else{}};Ext.MessageBox.prompt({title:localize("%deletMarkerTitle"),msg:localize("%deletMarkerText")+"<br /><br />"+localize("%deletMarkerText2")+"<br /><br />",width:300,buttons:Ext.MessageBox.OKCANCEL,multiline:true,fn:as,icon:Ext.MessageBox.WARNING,closable:false});};C.prototype.aD=function(marker){if(aJ.bh==undefined||aJ.bh.id!=marker.id){aJ.bI();aJ.am();if((marker.jump_marker_id!=undefined&&marker.jump_marker_id!=0)||(marker.cL==undefined||marker.tabTitle==undefined)){aJ.bh=marker;return;}if(marker.tabTitle.length>1){aJ.cJ=new InfoBubble();for(var i=0;i<marker.tabTitle.length;i++){var div=document.createElement('DIV');div.innerHTML=marker.cL[i]+"<p style='clear: both; text-align: right;'>Marker ID: "+marker.id+"<br />"+localize("%sentBy")+marker.dj[i]+"</p>";if(user.id==marker.bP[i]&&marker.bu){var p=document.createElement('P');p.innerHTML="[ "+localize("%delete")+" ]";p.style.cssFloat="right";p.onclick=function(){aJ.aG(marker);};div.appendChild(p);var p=document.createElement('P');p.innerHTML="[ "+localize("%edit")+" ]";p.style.cssFloat="right";p.onclick=function(){aJ.aa(marker);};div.appendChild(p);}aJ.cJ.addTab(marker.tabTitle[i],div);}}else{var div=document.createElement('DIV');div.innerHTML=marker.cL[0]+"<p style='clear: both; text-align: right;'>Marker ID: "+marker.id+"<br />"+localize("%sentBy")+marker.dj[0]+"</p>";aJ.cJ=new google.maps.InfoWindow({content:div});if(user.id==marker.bP[0]&&marker.bu){var p=document.createElement('P');p.innerHTML="[ "+localize("%delete")+" ]";p.style.cssFloat="right";p.onclick=function(){aJ.aG(marker);};div.appendChild(p);var p=document.createElement('P');p.innerHTML="[ "+localize("%edit")+" ]";p.style.cssFloat="right";p.onclick=function(){aJ.aa(marker);};div.appendChild(p);}}google.maps.event.addListener(aJ.cJ,'closeclick',function(){aJ.bh=undefined;});aJ.cJ.open(map,marker);aJ.bh=marker;}};C.prototype.bI=function(){if(aJ.cJ!=undefined){aJ.cJ.close();aJ.bh=undefined;}};C.prototype.bX=function(bG){this.bI();for(var i=0;i<this.al.length;i++){var marker=this.al[i];if(marker.id=bG){this.aD(marker);break;}}};C.prototype.av=function(dE){for(var i=0;i<al.length;i++){if(al[i].id==dE){return al[i];}}return null;};C.prototype.bz=function(){for(var i=0;i<al.length;i++){aJ.aY(al[i],user.id==al[i].az);}};C.prototype.aY=function(marker,draggable){if(draggable){marker.setDraggable(draggable);google.maps.event.addListener(marker,'dragstart',function(){aJ.ak=marker.getPosition();marker.dQ=marker.getPosition();aJ.bI();if(marker.categoryTypeId==3&&marker.label!=null){marker.label.set('text','');}});google.maps.event.addListener(marker,'drag',function(){if(aJ.aC(marker.getPosition())){aJ.ak=marker.getPosition();}else{marker.setPosition(aJ.ak);}});google.maps.event.addListener(marker,'dragend',function(){if(aJ.aC(marker.getPosition())){aJ.ak=marker.getPosition();}else{marker.setPosition(aJ.ak);}if(marker.categoryTypeId==3&&marker.label!=null){marker.label.set('text',marker.getTitle());}var bH=function(be,text,cv){if(be=='ok'&&Ext.isEmpty(text)){var newMsg='<span style="color:red">'+localize("%moveMarkerText")+'</span>';Ext.Msg.show(Ext.apply({},{msg:newMsg},cv));return;}if(be=='ok'){var bw=new Ext.data.Connection();bw.request({url:'ajax/marker_drag.php',method:'POST',params:{"marker_id":marker.id,"x":marker.getPosition().lat(),"y":marker.getPosition().lng(),"user_id":user.id,"reason":text},success:function(responseObject){Ext.MessageBox.show({title:localize("%success"),msg:localize("%addMarkerSuccessText"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});},failure:function(){Ext.MessageBox.show({title:localize("%err"),msg:localize("%errConnection"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});}});marker.setPosition(marker.dQ);}else{marker.setPosition(marker.dQ);}};Ext.MessageBox.prompt({title:localize("%moveMarkerTitle"),msg:localize("%moveMarkerText"),width:300,buttons:Ext.MessageBox.OKCANCEL,multiline:true,fn:bH,icon:Ext.MessageBox.QUESTION,closable:false});});}else{}};C.prototype.ab=function(){if(aJ.aV==aJ.bZ){return aJ.bh;}else{return bp;}};bE=function(i){return((i%1)==0)?i:false;};C.prototype.aB=function(bn,aF,categoryTypeId){if(!(typeof(bp)=="undefined"||bp==null)){this.am();this.bI();}if(!(typeof(bg)=="undefined"||bg==null)){if(!aJ.aC(bg)){return;}var marker;if(categoryTypeId==3){var image=new google.maps.MarkerImage(this.aK+"_"+category[bn].img,new google.maps.Size(121,49),new google.maps.Point(0,0),new google.maps.Point(60,39));var shape={aU:[1,1,120,48],type:'rect'};marker=new google.maps.Marker({position:bg,icon:image,shape:shape,map:map});}else{var aA=new google.maps.MarkerImage(this.aK+category[bn].img,new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,16));marker=new google.maps.Marker({position:bg,map:map,icon:aA});}map.panTo(bg);marker.mapId=map.getMapTypeId();if(!bE(marker.mapId)){for(var i=0;i<ah.length;i++){if(marker.mapId==ah[i].bL){marker.mapId=ah[i].mapId;break;}}}marker.bn=bn;var bQ=new google.maps.InfoWindow({content:aF});google.maps.event.addListener(bQ,'closeclick',aJ.am);marker.bQ=bQ;marker.bQ.open(map,marker);aF.form.render(aF);al.push(marker);bg=null;bp=marker;}};C.prototype.am=function(){if(!(typeof(bp)=="undefined"||bp==null)){bp.bQ.close();bp.bQ=null;bp.setMap(null);bp.form=null;bp=null;dN=0;}};C.prototype.bV=function(){var aL=function(be,text,cv){if(be=='ok'&&Ext.isEmpty(text)){var newMsg="<span style=\"color:red\">"+localize("%jumpMarkerTextConfirm")+"</span>";Ext.Msg.show(Ext.apply({},{msg:newMsg},cv));return;}if(be=='ok'){var bw=new Ext.data.Connection();bw.request({url:'ajax/marker_jump.php',method:'POST',params:{"user_id":user.id,"reason":text,"title":bb.getTitle(),"map_id":aJ.bC(bb.mapId),"overlay_id":bb.dh,"x":bb.getPosition().lat(),"y":bb.getPosition().lng(),"marker_id2":(bN.id==undefined?0:bN.id),"title2":bN.getTitle(),"map_id2":aJ.bC(bN.mapId),"overlay_id2":bN.dh,"x2":bN.getPosition().lat(),"y2":bN.getPosition().lng(),"category_id":bb.bn},success:function(responseObject){Ext.MessageBox.show({title:localize("%success"),msg:localize("%addMarkerSuccessText"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});aJ.aV==aJ.bD;aJ.bK();},failure:function(){Ext.MessageBox.show({title:localize("%err"),msg:localize("%errConnection"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});aJ.aV==aJ.bD;aJ.bK();}});}else{aJ.aV==aJ.bD;aJ.bK();}};Ext.MessageBox.prompt({title:localize("%jumpMarkerTitleConfirm"),msg:localize("%jumpMarkerTextConfirm"),width:300,buttons:Ext.MessageBox.OKCANCEL,multiline:true,fn:aL,icon:Ext.MessageBox.QUESTION,closable:false});};C.prototype.ae=function(cq){var cT=function(vBtn,cS,co){if(vBtn=='ok'&&Ext.isEmpty(cS)){var newMsg="<span style=\"color:red\">"+localize("%jumpMarkerTextInfo3")+"</span>";Ext.Msg.show(Ext.apply({},{msg:newMsg},co));return;}if(vBtn=='ok'){var marker=new google.maps.Marker({position:cq,map:map,title:cS,icon:aJ.aK+category[bb.bn].img});map.panTo(cq);marker.mapId=map.getMapTypeId();marker.bn=bb.bn;marker.dh=aJ.bJ;marker.bu=true;bg=null;bN=marker;al.push(marker);aJ.bV();}else{aJ.aV==aJ.bD;aJ.bK();}};Ext.MessageBox.prompt(localize("%jumpMarkerTitleInfo"),localize("%jumpMarkerTextInfo3"),cT);};C.prototype.bK=function(){if(!(typeof(bb)=="undefined"||bb==null)){bb.setMap(null);bb=null;}if(!(typeof(bN)=="undefined"||bN==null)){if((typeof(bN.id)=="undefined"||bN.id==null)){bN.setMap(null);bN=null;}}aJ.aV=aJ.bD;};C.prototype.bk=function(bn,aQ,source){if(!(typeof(bg)=="undefined"||bg==null)){this.aV=this.bS;if(!aJ.aC(bg)){return;}var marker=new google.maps.Marker({position:bg,map:map,title:aQ,icon:this.aK+category[bn].img});map.panTo(bg);marker.mapId=map.getMapTypeId();marker.bn=bn;marker.dh=this.bJ;marker.bu=true;bg=null;bb=marker;al.push(marker);Ext.MessageBox.prompt({title:localize("%jumpMarkerTitleInfo"),msg:localize("%jumpMarkerTextInfo2")+"<br /><br />",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});}else{this.aV=this.bD;}}